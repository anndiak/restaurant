<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="ISO-8859-1">
  <title>Registration Success</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script type="text/javascript">
    $( document ).ready(function() {

      $("#loadUsersBtn").click(() => {
        $("#loadUsersBtn").html("<span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span>Loading...")
        setTimeout(() => {
          $.get("/api/v1/admin/users", function (data) {
            console.log(data);
            let rows = "";
            let rowNumber = 1;
            data.forEach(function (row) {
              rows += `<tr>
                        <th scope="row">${rowNumber++}</th>
                        <td>${row.firstName}</td>
                        <td>${row.lastName}</td>
                        <td>${row.email}</td>
                        <td><button id='deleteUserBtn' type='button' class='btn btn-danger user-remove-btn' value="${row.id}">Delete</button></td>
                      </tr>`;
            });
            $("#usersList tbody").html(rows);
            $("#loadUsersBtn").html("Load users");

            $(".user-remove-btn").click((event) =>{
              let id = $(event.target).attr("value");
              $.ajax({
                type:"DELETE",
                url:"http://localhost:8080/api/v1/admin/users/" + id,
                success: function(data){
                  $("#loadUsersBtn").click();
                }
              });
            });
          });
        }, 1000);
      })
    });
  </script>
</head>
  <body>
    <nav class="navbar navbar-dark bg-dark">
      <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">Manage users</span>
      </div>
    </nav>
    <button id="loadUsersBtn" type="button" class="btn btn-primary">Load users</button>
    <button id="addUsersBtn" type="button" class="btn btn-primary">Add user</button>
    <table id="usersList" class="table">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">First</th>
          <th scope="col">Last</th>
          <th scope="col">Email</th>
          <th scope="col">Delete</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </body>
</html>